/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2024 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include <stdio.h>

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif


// Define the ITM Stimulus Port register address (usually 0xE0000000 + offset)
#define ITM_STIMULUS_PORT0 (*(volatile uint32_t*)0xE0000000)

// Define the ITM_TCR (Trace Control Register) address (usually 0xE0000E80)
#define ITM_TCR (*(volatile uint32_t*)0xE0000E80)

// Define the ITM_TER (Trace Enable Register) address (usually 0xE0000E00)
#define ITM_TER (*(volatile uint32_t*)0xE0000E00)

// Function to send a character through ITM
void ITM_SendChar(char ch) {
    // Check if ITM_TCR.ITMENA is set
    if (ITM_TCR & 1) {
        // Check if stimulus port 0 is enabled
        if (ITM_TER & 1) {
            // Check if the stimulus port 0 is ready
            while (ITM_STIMULUS_PORT0 == 0);
            // Write the character to the stimulus port 0
            ITM_STIMULUS_PORT0 = ch;
        }
    }
}

// Function to send a string through ITM
void ITM_SendString(const char *str) {
    while (*str) {
        ITM_SendChar(*str++);
    }
}


int main(void)
{
    char buffer[50];
//    is a function in the C standard library, defined in the header file <stdio.h>, that writes formatted output to a string.
//    The function is an improvement over sprintf because it includes bounds checking to prevent buffer overflows, which are common in sprintf.

    snprintf(buffer, sizeof(buffer), "Size of char: %u\n", sizeof(char));

    ITM_SendString(buffer);
    sprintf(buffer,"Size of char: %u\n",sizeof(char));

    ITM_SendString(buffer);
    /* Loop forever */
	for(;;);
}
